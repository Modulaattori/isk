<!DOCTYPE html>
<html>
<head>
  <title>Isk</title>
  <link href="/assets/application-3e14c74bebc32f2f5913976f95e57ff2.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/application-3ff1aea5cd87efbe994fac316e2d2045.js" type="text/javascript"></script>
  <meta content="authenticity_token" name="csrf-param" />
<meta content="47Q5z4UBkqW1hkqBYmKmoUKvqdNvf4L0pNAgi+MytP4=" name="csrf-token" />
	<link rel="icon" type="image/gif" href="favicon.gif" />
	<link rel="icon" type="image/x-icon" href="favicon.ico" />
	<style>
	svg {height: 255px; width: 400px;}
	</style>
</head>
<body>
<h1>ISK - Websocket tester</h1>

<script type="text/javascript">
var dispatcher = new WebSocketRails(window.location.host + '/websocket');

var s = {heading: "Fooosh!", text: "ASD foooo grrrrr\n jee \<ASD\>"};
var message = {simple: s};

var success = function(task) { 
	console.log("Got svg: " + task);
	$('.svg_container').html(task);
	$(".spinner").hide();
}

var failure = function(task) {
  console.log("Failed to create svg....");
}

var expire = function( callback, interval ) {
	var timer;
	return function() {
		clearTimeout( timer );
		timer = setTimeout( callback, interval );
	};
}

var updateSlide = function() {
	console.log("updating...");
	var msg = {simple: {heading: $("#heading").val(), text: $("#body").val()}};
	dispatcher.trigger('svg.simple', msg, success, failure);
}

var delayedUpdater = expire(updateSlide, 500);
 
dispatcher.trigger('svg.simple', message, success, failure);

$(function() {
	$("#submit").click(updateSlide); 
	$(".updater").on("input", function(){
		$(".spinner").show();
		delayedUpdater();
	});
});

</script>

<p>Parametrit ws-kutsulle: {simple: {text: "leip√§teksti", heading: "otsikko", align: "left" / "right" / "centered", color: "#303030", text_size: 72}}</p>

<input type="text" class="updater" id="heading"/>
<input type="textarea" class="updater" id="body"/>
<button id="submit">Show</button>

<span class="spinner" style="display:none">Update pending...</span>

<div class="svg_container" style="width: 400px; height 255px">
	<svg id='svg'>
		
	</svg>
</div>

</body>
</html>
